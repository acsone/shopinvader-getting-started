services:
  mongodb:
    image: mongo:3
    volumes:
      - mongodb:/data/db
  locomotive:
    image: quay.io/shopinvader/locomotive-shopinvader-demo:V4.0.x-20190924-1709
    environment:
      - RAILS_ENV=development
      - STORE_ASSET_IN_S3=false
      - DRAGON_FLY_SECRET=thisISaDEMOkeyNOTsecret
      - MONGODB_DEV_HOST=mongodb
      - LOCOMOTIVE_ADMIN_SSL_REDIRECT=false
      - LOCOMOTIVE_ENABLE_REGISTRATION=true
    volumes:
      - usr_src_app_log:/usr/src/app/tmp
      - usr_src_app_tmp:/usr/src/app/log
      - usr_src_app_public_sites:/usr/src/app/public/sites
      - usr_src_app_public_uploaded:/usr/src/app/public/uploaded_assets
    depends_on:
      - mongodb
      - elastic
    ports:
      - 3000:3000
  elastic:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.0.0
    environment:
      - discovery.type=single-node
    volumes:
      - esdata:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
  wagon:
    image: quay.io/shopinvader/wagon:v4.0.x-20190919
    ports:
      - 3333:3333
    volumes:
      - ./template:/workspace
    entrypoint: /usr/local/bin/entrypoint gosu ubuntu bash
version: '3'
volumes:
  usr_src_app_log:
  usr_src_app_tmp:
  usr_src_app_public_sites:
  usr_src_app_public_uploaded:
  mongodb:
  esdata:
